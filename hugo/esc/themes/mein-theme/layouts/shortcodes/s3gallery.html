<!-- Erweiterte S3 Gallery: layouts/shortcodes/s3gallery.html -->
{{- $bucket := .Get "bucket" | default (.Site.Params.s3.bucket | default "esc") -}}
{{- $path := .Get "path" -}}
{{- $images := .Get "images" -}}
{{- $columns := .Get "columns" | default "3" -}}
{{- $s3domain := .Get "s3domain" | default (.Site.Params.s3.domain | default "s3.kuepper.nrw") -}}
{{- $baseurl := .Get "baseurl" | default .Site.Params.s3.baseurl -}}
{{- $protocol := .Get "protocol" | default (.Site.Params.s3.protocol | default "https") -}}
{{- $showinfo := .Get "showinfo" | default "false" -}}

{{- if or $path $images .Inner -}}
<div class="s3-gallery" style="display: grid; grid-template-columns: repeat({{ $columns }}, 1fr); gap: 1rem; margin: 1rem 0;">
  
  {{- if .Inner -}}
    <!-- Erweiterte Galerie mit Infos aus .Inner -->
    {{- $lines := split (trim .Inner "\n") "\n" -}}
    {{- range $lines -}}
      {{- $line := trim . " " -}}
      {{- if $line -}}
        {{- $parts := split $line "|" -}}
        {{- if ge (len $parts) 2 -}}
          {{- $imagePath := index $parts 0 | strings.TrimSpace -}}
          {{- $title := index $parts 1 | strings.TrimSpace -}}
          {{- $description := "" -}}
          {{- $extra := "" -}}
          {{- if ge (len $parts) 3 -}}
            {{- $description = index $parts 2 | strings.TrimSpace -}}
          {{- end -}}
          {{- if ge (len $parts) 4 -}}
            {{- $extra = index $parts 3 | strings.TrimSpace -}}
          {{- end -}}
          
          <!-- <div class="gallery-item" style="position: relative;"> -->
          <div class="player-card">
            <div class="player-image">
            {{- if $baseurl -}}
            <img src="{{ $baseurl }}/{{ $imagePath }}" 
                 alt="{{ $title }}" 
                 style="width: 100%; height: auto; border-radius: 8px; cursor: pointer;"
                 onclick="openModal('{{ $baseurl }}/{{ $imagePath }}', '{{ $title }}', '{{ $description }}', '{{ $extra }}')">
            {{- else -}}
            <img src="{{ $protocol }}://{{ $bucket }}.{{ $s3domain }}/{{ $imagePath }}" 
                 alt="{{ $title }}" 
                 style="width: 100%; height: auto; border-radius: 8px; cursor: pointer;"
                 onclick="openModal('{{ $protocol }}://{{ $bucket }}.{{ $s3domain }}/{{ $imagePath }}', '{{ $title }}', '{{ $description }}', '{{ $extra }}')">
            {{- end -}}
            
            {{- if or $title $description $extra -}}
            <div class="image-info" style="position: absolute; bottom: 35px; left: 0; right: 20px; background: rgba(23, 23, 23, 0.8); color: white; padding: 1rem 0.5rem 0.5rem; border: #565656 solid 1px; border-radius: 8px 8px 8px 8px;">
              {{- if $title -}}<div style="font-weight: bold; font-size: 0.9rem;">{{ $title }}</div>{{- end -}}
              {{- if $description -}}<div style="font-size: 0.8rem; opacity: 0.9;">{{ $description }}</div>{{- end -}}
              {{- if $extra -}}<div style="font-size: 0.7rem; opacity: 0.8;">{{ $extra }}</div>{{- end -}}
            </div>
            {{- end -}}
          <!-- </div> -->
            </div>
          </div>

        {{- end -}}
      {{- end -}}
    {{- end -}}
    
  {{- else if $images -}}
    <!-- Einfache Galerie mit images Parameter -->
    {{- $imageList := split $images "," -}}
    {{- range $imageList -}}
      {{- $imagePath := . | strings.TrimSpace -}}
      <div class="gallery-item">
        {{- if $baseurl -}}
        <img src="{{ $baseurl }}/{{ $imagePath }}" 
             alt="Gallery Image" 
             style="width: 100%; height: auto; border-radius: 8px; cursor: pointer;"
             onclick="openModal('{{ $baseurl }}/{{ $imagePath }}', '', '', '')">
        {{- else -}}
        <img src="{{ $protocol }}://{{ $bucket }}.{{ $s3domain }}/{{ $imagePath }}" 
             alt="Gallery Image" 
             style="width: 100%; height: auto; border-radius: 8px; cursor: pointer;"
             onclick="openModal('{{ $protocol }}://{{ $bucket }}.{{ $s3domain }}/{{ $imagePath }}', '', '', '')">
        {{- end -}}
      </div>
    {{- end -}}
    
  {{- else if $path -}}
    <!-- Automatische Galerie f端r alle Bilder in einem Pfad (erfordert Liste) -->
    <p><em>Automatische Pfad-Galerie erfordert eine Liste von Bildern im "images" Parameter</em></p>
  {{- end -}}
</div>

<!-- Modal f端r Vollbildansicht mit Infos -->
<div id="imageModal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.9); cursor: pointer;" onclick="closeModal()">
  <img id="modalImage" style="margin: auto; display: block; max-width: 90%; max-height: 80%; margin-top: 2%;">
  
  <!-- Info-Bereich im Modal -->
  <div id="modalInfo" style="position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%); color: white; text-align: center; max-width: 90%;">
    <div id="modalTitle" style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem;"></div>
    <div id="modalDescription" style="font-size: 1rem; margin-bottom: 0.5rem; opacity: 0.9;"></div>
    <div id="modalExtra" style="font-size: 0.9rem; opacity: 0.8;"></div>
  </div>
  
  <span style="position: absolute; top: 15px; right: 35px; color: #f1f1f1; font-size: 40px; font-weight: bold; cursor: pointer;" onclick="closeModal()">&times;</span>
</div>

<script>
function openModal(src, title, description, extra) {
  document.getElementById('imageModal').style.display = 'block';
  document.getElementById('modalImage').src = src;
  
  // Info-Bereiche f端llen
  const titleEl = document.getElementById('modalTitle');
  const descEl = document.getElementById('modalDescription');
  const extraEl = document.getElementById('modalExtra');
  
  titleEl.textContent = title || '';
  titleEl.style.display = title ? 'block' : 'none';
  
  descEl.textContent = description || '';
  descEl.style.display = description ? 'block' : 'none';
  
  extraEl.textContent = extra || '';
  extraEl.style.display = extra ? 'block' : 'none';
}

function closeModal() {
  document.getElementById('imageModal').style.display = 'none';
}
</script>
{{- else -}}
<p><strong>Fehler:</strong> Pfad, Bilder-Liste oder Inhalt f端r S3-Galerie nicht angegeben</p>
{{- end -}}
<style>
  .player-gallery {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 30px;
    padding: 10px 0;
    margin: 10px 0;
  }
  
  .player-card {
    background: #222222;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 5px 2px 10px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  
  .player-card:hover {
    transform: translateY(-5px);
    box-shadow: 5px 5px 20px rgba(0, 0, 0, 0.15);
    background: #363636;
  }
  
  .player-image {
    /* width: 100%; */
    /* height: 300px; */
    /* overflow: hidden; */
    background-color: #454444;
    margin-left: 20px;
    margin-right: 20px;
  }
  
  .player-image img {
    width: 100%;
    height: 50%;
    /* object-fit: cover; */
    transition: transform 0.3s ease;
  }
  
  .player-card:hover .player-image img {
    transform: scale(1.05);

  }
  .image-info {
    /* display: none; */
    visibility: hidden;
    margin-left: 20px;
    /* background-color: #363636; */
    
  }

  .player-card:hover .image-info{
    display: block;
    visibility: visible;
  }
  .player-info {
    padding: 20px;
    text-align: center;
    background: rgb(255, 255, 255);
    /* display: none; */
  }
  
  .player-number {
    display: inline-block;
    background: #333;
    color: white;
    padding: 5px 15px;
    border-radius: 20px;
    font-weight: bold;
    font-size: 18px;
    margin-bottom: 10px;
  }
  
  .player-name {
    margin: 10px 0 5px 0;
    font-size: 16px;
    color: #333;
  }
  
  .player-position {
    margin: 0;
    color: #666;
    font-size: 16px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  
  @media (max-width: 768px) {
    .player-gallery {
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
    }
    
    .player-image {
      height: 250px;
    }
  }
  
  @media (max-width: 480px) {
    .player-gallery {
      grid-template-columns: 1fr;
    }
    
    .player-image {
      height: 350px;
    }
  }
  </style>